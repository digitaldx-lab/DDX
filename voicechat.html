<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sophia - AI Health Assistant</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 2. Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <!-- 3. Inter Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- 4. Custom Styles (from your implied CSS) -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden;
            height: 100vh;
            display: flex;
        }

        /* --- Authentication Modals --- */
        .auth-modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .auth-modal.active {
            display: flex;
        }
        .auth-content {
            background-color: white;
            padding: 2rem;
            border-radius: 1rem;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        .auth-header {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .auth-header h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1f2937;
        }
        .auth-header p {
            color: #4b5563;
            margin-top: 0.25rem;
        }
        .form-group {
            margin-bottom: 1.25rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #374151;
        }
        .form-group input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px #bfdbfe;
        }
        .auth-actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 1.5rem;
        }
        .auth-btn {
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        .auth-btn i {
            font-size: 1.1rem;
        }
        .auth-btn-primary {
            background-color: #2563eb;
            color: white;
        }
        .auth-btn-primary:hover {
            background-color: #1d4ed8;
        }
        .auth-btn-whatsapp {
            background-color: #25D366;
            color: white;
        }
        .auth-btn-whatsapp:hover {
            background-color: #1EAE50;
        }
        .auth-btn-secondary {
            background-color: #e5e7eb;
            color: #374151;
        }
        .auth-btn-secondary:hover {
            background-color: #d1d5db;
        }
        .auth-footer {
            margin-top: 1.5rem;
            text-align: center;
            font-size: 0.875rem;
            color: #6b7280;
        }
        .auth-footer a {
            color: #2563eb;
            font-weight: 500;
            text-decoration: none;
        }
        .auth-footer a:hover {
            text-decoration: underline;
        }
        .auth-footer p {
            margin-top: 0.5rem;
        }

        /* --- App Container --- */
        .app-container {
            display: flex;
            width: 100vw;
            height: 100vh;
        }

        /* --- Sidebar --- */
        #sidebar {
            width: 380px;
            height: 100%;
            background-color: #111827; /* gray-900 */
            color: #d1d5db; /* gray-300 */
            transition: width 0.3s ease;
            position: relative;
            flex-shrink: 0;
        }
        #sidebar.collapsed {
            width: 0;
            overflow: hidden;
        }
        .sidebar-overlay {
            background: linear-gradient(to bottom, rgba(17, 24, 39, 0.8), rgba(17, 24, 39, 1)), 
                        url('https://placehold.co/600x900/111827/4b5563?text=Health+Background') no-repeat center center;
            background-size: cover;
            width: 100%;
            height: 100%;
            padding: 2rem;
            display: flex;
            flex-direction: column;
        }
        .sidebar-content {
            flex-grow: 1;
        }
        .sidebar-title {
            font-size: 2.25rem;
            font-weight: 800;
            color: white;
            line-height: 1.2;
        }
        .sidebar-subtitle {
            font-size: 1rem;
            color: #d1d5db;
        }
        .features-list {
            list-style-type: none;
            padding: 0;
            margin-top: 1.5rem;
        }
        .features-list li {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1rem;
            color: #d1d5db;
            margin-bottom: 0.75rem;
        }
        .features-list i {
            color: #3b82f6; /* blue-500 */
        }
        .sidebar-footer {
            font-size: 0.875rem;
            color: #9ca3af; /* gray-400 */
        }

        /* --- Sidebar Toggle --- */
        .sidebar-toggle {
            position: absolute;
            left: 380px;
            top: 50%;
            transform: translateY(-50%);
            background-color: #1f2937; /* gray-800 */
            color: white;
            border: none;
            width: 2.5rem;
            height: 2.5rem;
            border-top-right-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            cursor: pointer;
            z-index: 50;
            transition: left 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #sidebar.collapsed + .sidebar-toggle {
            left: 0;
            border-radius: 0.5rem;
            transform: translateY(-50%) translateX(50%);
            top: 1rem;
            left: 1rem;
        }
        #sidebar.collapsed + .sidebar-toggle {
            left: 0;
            top: 1rem;
            transform: translateY(0);
            border-radius: 0.5rem;
        }
        
        /* --- Chat Container --- */
        #chat-container-wrapper {
            flex-grow: 1;
            height: 100%;
            position: relative;
            transition: all 0.3s ease;
        }
        
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                z-index: 100;
                width: 300px;
            }
            #sidebar.collapsed {
                width: 0;
            }
            .sidebar-toggle {
                left: 300px;
                background-color: #1f2937;
            }
            #sidebar.collapsed + .sidebar-toggle {
                left: 0;
            }
            #chat-container-wrapper {
                width: 100%;
            }
        }

        /* --- Cart Icons --- */
        .cart-icon {
            position: relative;
            cursor: pointer;
            color: #4b5563; /* gray-600 */
            font-size: 1.5rem;
        }
        .cart-icon:hover {
            color: #1f2937; /* gray-800 */
        }
        .cart-count {
            position: absolute;
            top: -8px;
            right: -10px;
            background-color: #ef4444; /* red-500 */
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        header .cart-icon {
            color: white;
            font-size: 1.25rem;
        }
        header .cart-icon:hover {
            color: #d1d5db; /* gray-300 */
        }
        
        /* --- Chat Bubbles --- */
        .chat-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .chat-message {
            display: flex;
            max-width: 80%;
        }
        .chat-message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }
        .chat-message.bot {
            align-self: flex-start;
        }
        .chat-bubble {
            padding: 0.75rem 1.25rem;
            border-radius: 1.25rem;
        }
        .chat-message.user .chat-bubble {
            background-color: #3b82f6; /* blue-500 */
            color: white;
            border-bottom-right-radius: 0.25rem;
        }
        .chat-message.bot .chat-bubble {
            background-color: #e5e7eb; /* gray-200 */
            color: #1f2937; /* gray-800 */
            border-bottom-left-radius: 0.25rem;
        }
        .chat-bubble p {
            margin: 0;
        }
        .chat-bubble .test-card {
            background-color: white;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            margin-top: 0.75rem;
            padding: 0.75rem;
        }
        .chat-bubble .test-card h4 {
            font-weight: 600;
            color: #111827;
        }
        .chat-bubble .test-card p {
            font-size: 0.875rem;
            color: #4b5563;
            margin: 0.25rem 0;
        }
        .chat-bubble .test-card .price {
            font-weight: 600;
            color: #16a34a; /* green-600 */
        }
        .chat-bubble .add-to-cart-btn {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            margin-top: 0.5rem;
            transition: background-color 0.2s;
        }
        .chat-bubble .add-to-cart-btn:hover {
            background-color: #2563eb;
        }
        .chat-bubble .loading {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .chat-bubble .loading span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #6b7280;
            animation: bounce 1.4s infinite ease-in-out both;
        }
        .chat-bubble .loading span:nth-child(1) { animation-delay: -0.32s; }
        .chat-bubble .loading span:nth-child(2) { animation-delay: -0.16s; }
        @keyframes bounce {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1.0); }
        }

        /* --- Quick Replies --- */
        #quick-replies button {
            background-color: #f3f4f6; /* gray-100 */
            border: 1px solid #d1d5db; /* gray-300 */
            color: #374151; /* gray-700 */
            padding: 0.5rem 1rem;
            border-radius: 9999px; /* rounded-full */
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        #quick-replies button:hover {
            background-color: #e5e7eb; /* gray-200 */
            border-color: #9ca3af; /* gray-400 */
        }

        /* --- Keypad & Voice --- */
        .keypad {
            position: relative;
        }
        .voice-controls {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-left: 0.75rem;
        }
        .voice-btn {
            background-color: #f3f4f6;
            border: 1px solid #d1d5db;
            color: #4b5563;
            width: 3rem; /* 48px */
            height: 3rem; /* 48px */
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        .voice-btn:hover {
            background-color: #e5e7eb;
        }
        .voice-btn.listen.listening {
            background-color: #ef4444; /* red-500 */
            color: white;
            animation: pulse 1.5s infinite;
        }
        .voice-btn.speak.speaking {
            background-color: #3b82f6; /* blue-500 */
            color: white;
        }
        .voice-status {
            display: none; /* Hidden for a cleaner UI, but functional */
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }

        /* --- Cart Sidebar --- */
        .cart-aside {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background-color: white;
            box-shadow: -10px 0 20px rgba(0,0,0,0.1);
            z-index: 900;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
        }
        .cart-aside.active {
            right: 0;
        }
        @media (max-width: 450px) {
            .cart-aside {
                width: 100%;
                right: -100%;
            }
        }
        .cart-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
        }
        .close-cart {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: #6b7280;
            cursor: pointer;
        }
        .cart-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1.5rem;
        }
        .cart-empty {
            text-align: center;
            color: #6b7280;
            padding-top: 4rem;
        }
        .cart-empty i {
            font-size: 4rem;
            color: #d1d5db;
        }
        .cart-empty p {
            margin-top: 1rem;
            font-weight: 500;
        }
        .cart-item {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .item-image {
            width: 64px;
            height: 64px;
            border-radius: 0.5rem;
            overflow: hidden;
            flex-shrink: 0;
        }
        .item-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .item-details {
            flex-grow: 1;
        }
        .item-name {
            font-weight: 600;
            color: #1f2937;
        }
        .item-category {
            font-size: 0.875rem;
            color: #6b7280;
        }
        .item-controls {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 0.5rem;
        }
        .quantity-controls {
            display: flex;
            align-items: center;
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
        }
        .quantity-btn {
            background: none;
            border: none;
            color: #3b82f6;
            font-weight: 600;
            font-size: 1.25rem;
            width: 2rem;
            height: 2rem;
            cursor: pointer;
        }
        .quantity {
            width: 2rem;
            text-align: center;
            font-weight: 500;
        }
        .remove-btn {
            background: none;
            border: none;
            color: #ef4444;
            font-size: 0.875rem;
            cursor: pointer;
        }
        .cart-footer {
            padding: 1.5rem;
            border-top: 1px solid #e5e7eb;
        }
        .cart-total {
            display: flex;
            justify-content: space-between;
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
        }
        .checkout-btn {
            background-color: #25D366;
            color: white;
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            font-size: 1rem;
        }
        .checkout-btn:hover {
            background-color: #1EAE50;
        }

        /* --- Cart Notification --- */
        .cart-notification {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #22c55e; /* green-500 */
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            z-index: 1001;
            transition: bottom 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .cart-notification.show {
            bottom: 20px;
        }
    </style>
</head>
<body class="bg-gray-100">

    <!-- Authentication Modal -->
    <div class="auth-modal" id="auth-modal">
        <div class="auth-content">
            <div class="auth-header">
                <h2>Member Verification</h2>
                <p>Please verify your membership to continue</p>
            </div>
            <form class="auth-form" id="auth-form">
                <div class="form-group">
                    <label for="member-id">Member ID</label>
                    <input type="text" id="member-id" placeholder="Enter your member ID (e.g., XTR-0001)" required>
                </div>
                <div class="form-group">
                    <label for="member-name">Full Name</label>
                    <input type="text" id="member-name" placeholder="Enter your full name" required>
                </div>
                <div class="auth-actions">
                    <button type="submit" class="auth-btn auth-btn-primary">
                        <i class="fas fa-check"></i> Verify & Continue
                    </button>
                </div>
            </form>
            <div class="auth-footer">
                <p>Not a member? <a href="#" id="register-link">Register now</a></p>
                <p>Having issues with your registration? <a href="#" id="issues-link">Get help</a></p>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="auth-modal" id="register-modal">
        <div class="auth-content">
            <div class="auth-header">
                <h2>Registration Required</h2>
                <p>You need to register to continue using our services</p>
            </div>
            <form class="auth-form" id="register-form">
                <div class="form-group">
                    <label for="register-name">Your Name</label>
                    <input type="text" id="register-name" placeholder="Enter your full name" required>
                </div>
                <div class="auth-actions">
                    <button type="button" class="auth-btn auth-btn-whatsapp" id="register-whatsapp">
                        <i class="fab fa-whatsapp"></i> Register via WhatsApp
                    </button>
                    <button type="button" class="auth-btn auth-btn-secondary" id="back-to-auth">
                        <i class="fas fa-arrow-left"></i> Back to Verification
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Issues Modal -->
    <div class="auth-modal" id="issues-modal">
        <div class="auth-content">
            <div class="auth-header">
                <h2>Registration Issues</h2>
                <p>Having problems with your registration code?</p>
            </div>
            <form class="auth-form" id="issues-form">
                <div class="form-group">
                    <label for="issues-name">Your Name</label>
                    <input type="text" id="issues-name" placeholder="Enter your full name" required>
                </div>
                <div class="auth-actions">
                    <button type="button" class="auth-btn auth-btn-whatsapp" id="issues-whatsapp">
                        <i class="fab fa-whatsapp"></i> Get Help via WhatsApp
                    </button>
                    <button type="button" class="auth-btn auth-btn-secondary" id="back-to-auth-issues">
                        <i class="fas fa-arrow-left"></i> Back to Verification
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="app-container">
        <!-- Sidebar -->
        <div id="sidebar">
            <div class="sidebar-overlay">
                <div style="display: flex; justify-content: center;">
                    <!-- Replaced local image with placeholder -->
                    <img src="https://placehold.co/150x80/ffffff/333333?text=X-Trim" alt="X-Trim Logo" width="150">
                </div>
                <!-- Removed extra <br> tags -->
                <div class="sidebar-content mt-20"> <!-- Added margin-top -->
                    <h1 class="sidebar-title">Your Health, Our Priority</h1>
                    <p class="sidebar-subtitle mt-8">Sophia AI Assistant is here to help you understand your symptoms and find the right tests</p>
                    
                    <ul class="features-list mt-8">
                        <li><i class="fas fa-check-circle"></i> AI-powered symptom analysis</li>
                        <li><i class="fas fa-check-circle"></i> Professional test recommendations</li>
                        <li><i class="fas fa-check-circle"></i> Transparent pricing</li>
                        <li><i class="fas fa-check-circle"></i> Fast results delivery</li>
                    </ul>
                </div>
                
                <div class="sidebar-footer">
                    <p>© 2025 X-Trim Research Ltd. All rights reserved.</p>
                </div>
            </div>
        </div>
        
        <!-- Sidebar Toggle Button -->
        <button class="sidebar-toggle" id="sidebar-toggle">
            <i class="fas fa-chevron-left" id="toggle-icon"></i>
        </button>
        
        <!-- Chat Container -->
        <div id="chat-container-wrapper">
            <!-- Cart Icon -->
            <div class="fixed top-4 right-4 z-50 md:hidden"> <!-- Hide on medium screens and up -->
                <div class="cart-icon" id="cart-icon">
                    <i class="fas fa-shopping-cart"></i>
                    <span class="cart-count" id="cart-count">0</span>
                </div>
            </div>

            <!-- Chat Widget -->
            <div class="w-full h-full bg-white flex flex-col">
                <!-- Chatbot Interface -->
                <div class="w-full flex flex-col h-full">
                    <header class="bg-gray-800 text-white p-4 flex items-center justify-between shadow-md">
                        <div class="flex items-center">
                            <div class="w-12 h-12 rounded-full overflow-hidden mr-4 flex-shrink-0">
                                <!-- Replaced local image with placeholder -->
                                <img src="https://placehold.co/100/4B5563/FFFFFF?text=Sophia" alt="Sophia" class="w-full h-full object-cover">
                            </div>
                            
                            <div>
                                <h1 class="text-xl font-bold">Sophia</h1>
                                <p class="text-sm text-gray-300">Your Personal Health Guide</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-4">
                            <!-- Show this cart icon on medium screens and up -->
                            <div class="cart-icon hidden md:block" id="cart-icon-header">
                                <i class="fas fa-shopping-cart"></i>
                                <span class="cart-count" id="cart-count-header">0</span>
                            </div>
                        </div>
                    </header>

                    <main id="chat-container" class="flex-1 p-6 overflow-y-auto chat-container bg-gray-50">
                        <!-- Chat messages will be appended here -->
                    </main>

                    <footer class="p-4 bg-white border-t border-gray-200">
                        <div id="quick-replies" class="flex flex-wrap gap-2 mb-3">
                            <!-- Quick replies will be appended here -->
                        </div>
                        <div class="flex items-center keypad">
                            <input type="text" id="user-input" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 transition" placeholder="Type your symptoms...">
                            <button id="send-btn" class="ml-3 bg-blue-600 text-white px-5 py-3 rounded-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition shadow-lg flex-shrink-0">
                                <!-- Changed icon to a send paper plane -->
                                <i class="fas fa-paper-plane"></i>
                            </button>
                            <!-- Your Voice Controls -->
                            <div class="voice-controls">
                                <div class="flex flex-col items-center">
                                    <button id="listen-btn" class="voice-btn listen" title="Speak to Sophia">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <div id="voice-status" class="voice-status"></div>
                                </div>
                                <div class="flex flex-col items-center">
                                    <button id="speak-btn" class="voice-btn speak" title="Hear Sophia's response">
                                        <i class="fas fa-volume-up"></i>
                                    </button>
                                    <div id="speak-status" class="voice-status"></div>
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            </div>
        </div>
    </div>

    <!-- Cart Sidebar -->
    <div class="cart-aside" id="cart-sidebar">
        <div class="cart-header">
            <h3>Your Cart</h3>
            <button class="close-cart" id="close-cart">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="cart-content" id="cart-content">
            <!-- Cart items will be populated here -->
        </div>
        <div class="cart-footer">
            <div class="cart-total">
                <span>Total:</span>
                <span id="cart-total-price">₦0</span>
            </div>
            <button class="checkout-btn" id="checkout-btn">
                <i class="fab fa-whatsapp"></i>
                Checkout via WhatsApp
            </button>
        </div>
    </div>

    <!-- Cart Notification -->
    <div class="cart-notification" id="cart-notification">
        <i class="fas fa-check"></i>
        <span>Item added to cart!</span>
    </div>

    <!-- No config.js needed for this version -->
    
    <script>
        // --- 1. CHATBOT CORE (NEW) ---
        
        // --- Gemini API Configuration ---
        // DO NOT ADD AN API KEY HERE. The environment will provide it.
        const API_KEY = ""; 
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        
        const chatContainer = document.getElementById('chat-container');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const quickRepliesContainer = document.getElementById('quick-replies');
        
        let conversationHistory = [];
        
        // System prompt to guide the AI
        const systemPrompt = `
You are Sophia, an AI health assistant for X-Trim Research Lab.
Your role is to:
1.  Be empathetic, clear, and professional.
2.  Listen to the user's symptoms.
3.  Ask clarifying questions if needed.
4.  Suggest relevant lab tests based on the symptoms.
5.  Provide a *brief* explanation for *why* a test is suggested.
6.  You can suggest 1-3 tests at a time.
7.  **CRITICAL:** You are an AI assistant, NOT a doctor. You cannot diagnose, prescribe medication, or give medical advice. You MUST include a disclaimer in your first response and anytime you suggest tests, e.g., "Please note, I am an AI assistant and not a medical professional. These suggestions are for informational purposes. Please consult with a doctor."
8.  **Output Format:** Respond with a JSON object. The JSON MUST have this structure:
    {
      "message": "Your conversational reply to the user, including any disclaimers.",
      "suggestedTests": [
        {
          "id": "T001",
          "name": "Full Blood Count (FBC)",
          "category": "General Health",
          "reason": "To check for infection or anemia, which can be related to your symptoms.",
          "price": 5000,
          "image": "https://placehold.co/100/e0f2fe/0c4a6e?text=FBC"
        }
      ],
      "quickReplies": ["Tell me more about FBC", "What is a 'Full Blood Count'?", "Any other suggestions?"]
    }
9.  If you are just chatting and not suggesting a test, return an empty "suggestedTests" array.
10. Always provide 3-4 relevant "quickReplies".
`;

        // Initialize conversation history with the system prompt
        conversationHistory.push({
            role: "system",
            parts: [{ text: systemPrompt }]
        });
        
        /**
         * Adds a message to the chat interface.
         */
        function addMessage(sender, message, suggestedTests = []) {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', sender);
            
            let testCardsHTML = '';
            if (suggestedTests && suggestedTests.length > 0) {
                testCardsHTML = suggestedTests.map(test => `
                    <div class="test-card">
                        <h4>${test.name}</h4>
                        <p>${test.reason}</p>
                        <p class="price">Price: ₦${test.price.toLocaleString()}</p>
                        <button class="add-to-cart-btn" 
                                data-id="${test.id}"
                                data-name="${test.name}"
                                data-price="${test.price}"
                                data-category="${test.category}"
                                data-image="${test.image}">
                            Add to Cart
                        </button>
                    </div>
                `).join('');
            }
            
            messageElement.innerHTML = `
                <div class="chat-bubble">
                    ${message}
                    ${testCardsHTML}
                </div>
            `;
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            
            // Store bot messages for speech synthesis
            if (sender === 'bot' && window.voiceFeature) {
                // Strip HTML tags for cleaner speech
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = message;
                const cleanMessage = tempDiv.textContent || tempDiv.innerText || "";
                
                window.voiceFeature.setLastBotMessage(cleanMessage);
            }
        }
        
        /**
         * Updates the quick reply buttons.
         */
        function updateQuickReplies(replies) {
            quickRepliesContainer.innerHTML = '';
            if (!replies || replies.length === 0) {
                quickRepliesContainer.style.display = 'none';
                return;
            }
            
            quickRepliesContainer.style.display = 'flex';
            replies.forEach(reply => {
                const button = document.createElement('button');
                button.textContent = reply;
                button.addEventListener('click', () => {
                    handleUserInput(reply);
                });
                quickRepliesContainer.appendChild(button);
            });
        }
        
        /**
         * Shows a loading indicator.
         */
        function showLoading() {
            const messageElement = document.createElement('div');
            messageElement.classList.add('chat-message', 'bot', 'loading-message');
            messageElement.innerHTML = `
                <div class="chat-bubble">
                    <div class="loading">
                        <span></span>
                        <span></span>
                        <span></span>
                    </div>
                </div>
            `;
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        /**
         * Hides the loading indicator.
         */
        function hideLoading() {
            const loadingElement = chatContainer.querySelector('.loading-message');
            if (loadingElement) {
                loadingElement.remove();
            }
        }
        
        /**
         * Handles user input (from text or voice).
         */
        async function handleUserInput(text) {
            const userMessage = text.trim();
            if (userMessage === '') return;
            
            // 1. Add user message to UI
            addMessage('user', userMessage);
            userInput.value = '';
            updateQuickReplies([]); // Clear quick replies
            
            // 2. Add user message to history
            conversationHistory.push({
                role: "user",
                parts: [{ text: userMessage }]
            });
            
            // 3. Show loading
            showLoading();
            
            // 4. Check for auth
            userMessageCount++;
            if (!isAuthenticated && userMessageCount > AUTH_TRIGGER_COUNT) {
                hideLoading();
                showAuthModal();
                // We'll stop here and let the auth modal handle the flow
                return;
            }
            
            // 5. Call AI
            try {
                const botResponse = await callGeminiAPI(userMessage);
                
                // 6. Add bot message to UI and history
                addMessage('bot', botResponse.message, botResponse.suggestedTests);
                updateQuickReplies(botResponse.quickReplies);
                
                conversationHistory.push({
                    role: "model",
                    parts: [{ text: JSON.stringify(botResponse) }]
                });
                
            } catch (error) {
                console.error('Error calling Gemini API:', error);
                addMessage('bot', "I'm sorry, I'm having trouble connecting right now. Please try again in a moment.");
            } finally {
                // 7. Hide loading
                hideLoading();
            }
        }
        
        /**
         * Calls the Gemini API with exponential backoff.
         */
        async function callGeminiAPI(prompt, retries = 3, delay = 1000) {
            const payload = {
                contents: conversationHistory,
                // Grounding is not used here to ensure the bot follows its system prompt
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };
            
            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(payload)
                });
                
                if (!response.ok) {
                    throw new Error(`API Error: ${response.statusText}`);
                }
                
                const result = await response.json();
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (!text) {
                    throw new Error("Invalid API response format.");
                }

                // Clean the text before parsing
                let cleanText = text.replace(/```json/g, '').replace(/```/g, '').trim();
                
                // Parse the JSON response
                return JSON.parse(cleanText);
                
            } catch (error) {
                console.error(`API call failed: ${error.message}`);
                if (retries > 0) {
                    await new Promise(res => setTimeout(res, delay));
                    return callGeminiAPI(prompt, retries - 1, delay * 2); // Exponential backoff
                } else {
                    throw new Error("Failed to get response from AI after multiple attempts.");
                }
            }
        }
        
        
        // --- 2. YOUR VOICE FEATURE CLASS (UNCHANGED) ---
        class VoiceFeature {
            constructor() {
                this.recognition = null;
                this.synthesis = null;
                this.isListening = false;
                this.isSpeaking = false;
                this.lastBotMessage = '';
                
                this.initializeSpeechRecognition();
                this.initializeSpeechSynthesis();
                this.setupEventListeners();
                
                // Try to load voices immediately
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.getVoices();
                }
            }
            
            // Initialize Speech Recognition
            initializeSpeechRecognition() {
                if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                    this.updateVoiceStatus('Speech recognition not supported');
                    document.getElementById('listen-btn').disabled = true;
                    return;
                }
                
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                this.recognition = new SpeechRecognition();
                this.recognition.continuous = false;
                this.recognition.interimResults = false;
                this.recognition.lang = 'en-US';
                
                this.recognition.onstart = () => {
                    this.isListening = true;
                    this.updateVoiceStatus('Listening...');
                    document.getElementById('listen-btn').classList.add('listening');
                };
                
                this.recognition.onresult = (event) => {
                    const transcript = event.results[0][0].transcript;
                    this.handleVoiceInput(transcript);
                };
                
                this.recognition.onerror = (event) => {
                    console.error('Speech recognition error:', event.error);
                    this.updateVoiceStatus('Error: ' + event.error);
                    this.stopListening();
                };
                
                this.recognition.onend = () => {
                    this.stopListening();
                };
            }
            
            // Initialize Speech Synthesis
            initializeSpeechSynthesis() {
                if (!('speechSynthesis' in window)) {
                    this.updateSpeakStatus('Speech synthesis not supported');
                    document.getElementById('speak-btn').disabled = true;
                    return;
                }
                
                this.synthesis = window.speechSynthesis;
                
                // onvoiceschanged is necessary for some browsers to load voices
                this.synthesis.onvoiceschanged = () => {
                    const voices = this.synthesis.getVoices();
                    if(voices.length > 0) {
                        this.updateSpeakStatus('Click speaker to hear response');
                    }
                };

                // Set up event handlers for the utterance itself
                const utterance = new SpeechSynthesisUtterance();
                utterance.onstart = () => {
                    this.isSpeaking = true;
                    this.updateSpeakStatus('Speaking...');
                    document.getElementById('speak-btn').classList.add('speaking');
                };
                
                utterance.onend = () => {
                    this.stopSpeaking();
                };
                
                utterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    this.updateSpeakStatus('Error speaking');
                    this.stopSpeaking();
                };
            }
            
            // Set up event listeners for voice buttons
            setupEventListeners() {
                const listenBtn = document.getElementById('listen-btn');
                const speakBtn = document.getElementById('speak-btn');
                
                listenBtn.addEventListener('click', () => {
                    if (this.isListening) {
                        this.stopListening();
                    } else {
                        this.startListening();
                    }
                });
                
                speakBtn.addEventListener('click', () => {
                    if (this.isSpeaking) {
                        this.stopSpeaking();
                    } else {
                        this.speakLastResponse();
                    }
                });
            }
            
            // Start listening for voice input
            startListening() {
                if (!this.recognition) {
                    this.updateVoiceStatus('Speech recognition not available');
                    return;
                }
                
                try {
                    this.recognition.start();
                } catch (error) {
                    console.error('Error starting speech recognition:', error);
                    this.updateVoiceStatus('Error starting recognition');
                }
            }
            
            // Stop listening
            stopListening() {
                if (this.recognition && this.isListening) {
                    this.recognition.stop();
                }
                
                this.isListening = false;
                document.getElementById('listen-btn').classList.remove('listening');
                this.updateVoiceStatus('Click microphone to speak');
            }
            
            // Handle voice input
            handleVoiceInput(transcript) {
                this.updateVoiceStatus('Processing...');
                document.getElementById('user-input').value = transcript;
                
                setTimeout(() => {
                    handleUserInput(transcript);
                }, 500); // Give a moment to see the text
            }
            
            // Speak the last bot response
            speakLastResponse() {
                if (!this.synthesis || this.lastBotMessage === '') {
                    this.updateSpeakStatus('No message to speak');
                    return;
                }
                
                if (this.isSpeaking) {
                    this.stopSpeaking();
                    return;
                }
                
                // Create a new speech utterance
                const utterance = new SpeechSynthesisUtterance(this.lastBotMessage);
                
                utterance.onstart = () => {
                    this.isSpeaking = true;
                    this.updateSpeakStatus('Speaking...');
                    document.getElementById('speak-btn').classList.add('speaking');
                };
                
                utterance.onend = () => {
                    this.stopSpeaking();
                };
                
                utterance.onerror = (event) => {
                    console.error('Speech synthesis error:', event);
                    this.updateSpeakStatus('Error speaking');
                    this.stopSpeaking();
                };

                // Configure voice properties
                utterance.rate = 0.9;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                const voices = this.synthesis.getVoices();
                const femaleVoice = voices.find(voice => 
                    voice.name.includes('Female') || 
                    voice.name.includes('female') ||
                    voice.name.includes('Samantha') || 
                    voice.name.includes('Google UK English Female') ||
                    voice.name.includes('Google US English') // Broader fallback
                );
                
                if (femaleVoice) {
                    utterance.voice = femaleVoice;
                }
                
                this.synthesis.speak(utterance);
            }
            
            // Stop speaking
            stopSpeaking() {
                if (this.synthesis) {
                    this.synthesis.cancel();
                }
                
                this.isSpeaking = false;
                document.getElementById('speak-btn').classList.remove('speaking');
                this.updateSpeakStatus('Click speaker to hear response');
            }
            
            // Update voice status message
            updateVoiceStatus(message) {
                // We keep this element hidden, but the title attribute is useful
                document.getElementById('listen-btn').title = message;
            }
            
            // Update speak status message
            updateSpeakStatus(message) {
                document.getElementById('speak-btn').title = message;
            }
            
            // Store the last bot message for speech synthesis
            setLastBotMessage(message) {
                this.lastBotMessage = message;
            }
        }
        
        
        // --- 3. YOUR CART SYSTEM (UNCHANGED) ---
        class CartSystem {
            constructor() {
                this.cart = this.loadCart();
                this.updateCartUI();
            }

            loadCart() {
                try {
                    const cartData = sessionStorage.getItem('suggestCart');
                    return cartData ? JSON.parse(cartData) : {};
                } catch (error) {
                    console.error('Error loading cart from sessionStorage:', error);
                    return {};
                }
            }

            saveCart() {
                try {
                    sessionStorage.setItem('suggestCart', JSON.stringify(this.cart));
                } catch (error) {
                    console.error('Error saving cart to sessionStorage:', error);
                }
            }

            addItem(test) {
                if (this.cart[test.id]) {
                    this.showNotification('Item already in cart!');
                    return false;
                }

                this.cart[test.id] = {
                    ...test,
                    quantity: 1
                };

                this.saveCart();
                this.updateCartUI();
                this.showNotification('Test added to cart!');
                return true;
            }

            removeItem(testId) {
                if (this.cart[testId]) {
                    delete this.cart[testId];
                    this.saveCart();
                    this.updateCartUI();
                    this.showNotification('Item removed from cart');
                }
            }

            updateQuantity(testId, newQuantity) {
                if (this.cart[testId]) {
                    newQuantity = parseInt(newQuantity);
                    if (newQuantity <= 0) {
                        this.removeItem(testId);
                    } else {
                        this.cart[testId].quantity = newQuantity;
                        this.saveCart();
                        this.updateCartUI();
                    }
                }
            }

            getCartCount() {
                return Object.keys(this.cart).length;
            }

            getCartTotal() {
                return Object.values(this.cart).reduce((total, item) => {
                    return total + (parseFloat(item.price) * item.quantity);
                }, 0);
            }

            updateCartUI() {
                const cartCount = this.getCartCount();
                document.getElementById('cart-count').textContent = cartCount;
                document.getElementById('cart-count-header').textContent = cartCount;
                this.updateCartContent();
            }

            updateCartContent() {
                const cartContent = document.getElementById('cart-content');
                if (!cartContent) return;

                if (this.getCartCount() === 0) {
                    cartContent.innerHTML = `
                        <div class="cart-empty">
                            <i class="fas fa-shopping-cart"></i>
                            <p>Your cart is empty</p>
                        </div>
                    `;
                } else {
                    let itemsHTML = '';
                    Object.values(this.cart).forEach(item => {
                        itemsHTML += `
                            <div class="cart-item">
                                <div class="item-image">
                                    <img src="${item.image}" alt="${item.name}">
                                </div>
                                <div class="item-details">
                                    <div class="item-name">${item.name}</div>
                                    <div class="item-category">${item.category}</div>
                                </div>
                                <div class="item-controls">
                                    <div class="quantity-controls">
                                        <button class="quantity-btn decrease" data-id="${item.id}">-</button>
                                        <span class="quantity">${item.quantity}</span>
                                        <button class="quantity-btn increase" data-id="${item.id}">+</button>
                                    </div>
                                    <button class="remove-btn" data-id="${item.id}">Remove</button>
                                </div>
                            </div>
                        `;
                    });
                    cartContent.innerHTML = itemsHTML;

                    cartContent.querySelectorAll('.decrease').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            const currentQuantity = this.cart[id].quantity;
                            this.updateQuantity(id, currentQuantity - 1);
                        });
                    });

                    cartContent.querySelectorAll('.increase').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            const currentQuantity = this.cart[id].quantity;
                            this.updateQuantity(id, currentQuantity + 1);
                        });
                    });

                    cartContent.querySelectorAll('.remove-btn').forEach(btn => {
                        btn.addEventListener('click', (e) => {
                            const id = e.target.dataset.id;
                            this.removeItem(id);
                        });
                    });
                }

                document.getElementById('cart-total-price').textContent = `₦${this.getCartTotal().toLocaleString()}`;
            }

            showNotification(message) {
                const notification = document.getElementById('cart-notification');
                if (notification) {
                    notification.querySelector('span').textContent = message;
                    notification.classList.add('show');
                    setTimeout(() => {
                        notification.classList.remove('show');
                    }, 2000);
                }
            }

            clearCart() {
                this.cart = {};
                this.saveCart();
                this.updateCartUI();
            }

            checkout() {
                if (this.getCartCount() === 0) {
                    this.showNotification("Your cart is empty!");
                    return;
                }

                const message = this.formatWhatsAppMessage();
                const phoneNumber = '+2348120527885'; // Replace with your WhatsApp number
                openWhatsApp(message, phoneNumber);
            }

            formatWhatsAppMessage() {
                const items = Object.values(this.cart);
                const itemsList = items.map(item => 
                    `• ${item.name} (${item.quantity})`
                ).join('\n');
                const total = this.getCartTotal().toLocaleString();

                return `Hello! I would like to order the following lab tests (Suggested by Sophia):\n\n${itemsList}\n\n*Total: ₦${total}*\n\nPlease provide payment details. Thank you!`;
            }
        }
        
        // --- 4. YOUR AUTH LOGIC (UNCHANGED) ---
        const registeredUsers = {
            'XTR-0001': { 
                id: 'XTR-0001',
                name: 'Doc Joseph Ikedi', 
                phone: '+2348037346656'
            }
        };

        let isAuthenticated = false;
        let userMessageCount = 0;
        const AUTH_TRIGGER_COUNT = 3;

        function showAuthModal() {
            document.getElementById('auth-modal').classList.add('active');
        }

        function hideAuthModal() {
            document.getElementById('auth-modal').classList.remove('active');
        }

        function showRegisterModal() {
            document.getElementById('register-modal').classList.add('active');
            hideAuthModal();
        }

        function hideRegisterModal() {
            document.getElementById('register-modal').classList.remove('active');
        }

        function showIssuesModal() {
            document.getElementById('issues-modal').classList.add('active');
            hideAuthModal();
        }

        function hideIssuesModal() {
            document.getElementById('issues-modal').classList.remove('active');
        }

        function verifyUser(memberId, memberName) {
            const normalizedId = memberId.toUpperCase().trim();
            const normalizedName = memberName.trim().toLowerCase();
            
            if (registeredUsers[normalizedId] && 
                registeredUsers[normalizedId].name.toLowerCase() === normalizedName) {
                return true;
            }
            return false;
        }

        function openWhatsApp(message, phoneNumber) {
            const num = phoneNumber || '+2348120527885'; // Default number
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            const whatsappUrl = isMobile 
                ? `https://wa.me/${num}?text=${encodeURIComponent(message)}`
                : `https://web.whatsapp.com/send?phone=${num}&text=${encodeURIComponent(message)}`;
            
            window.open(whatsappUrl, '_blank');
        }
        
        // --- 5. EVENT LISTENERS & INITIALIZATION (NEW/UPDATED) ---
        
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize systems
            window.suggestCart = new CartSystem();
            window.voiceFeature = new VoiceFeature();
            
            // Get DOM elements
            const sidebar = document.getElementById('sidebar');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const toggleIcon = document.getElementById('toggle-icon');
            const chatContainerWrapper = document.getElementById('chat-container-wrapper');
            const cartSidebar = document.getElementById('cart-sidebar');
            
            // Initial bot message
            const initialResponse = {
                message: "Hello! I'm Sophia, your personal health assistant at X-Trim Research Lab. I can help you understand your symptoms and suggest relevant lab tests. What's your main symptom today? <br><br><small><b>Disclaimer:</b> I am an AI, not a medical professional. Please consult a doctor for diagnosis.</small>",
                suggestedTests: [],
                quickReplies: ['Headache', 'Fever', 'Stomach Pain', 'Fatigue']
            };
            
            conversationHistory.push({
                role: "model",
                parts: [{ text: JSON.stringify(initialResponse) }]
            });
            addMessage('bot', initialResponse.message);
            updateQuickReplies(initialResponse.quickReplies);

            // --- Chat Listeners ---
            sendBtn.addEventListener('click', () => handleUserInput(userInput.value));
            userInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleUserInput(userInput.value);
                }
            });
            
            // Add to Cart listener (using event delegation)
            chatContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('add-to-cart-btn')) {
                    const button = e.target;
                    const test = {
                        id: button.dataset.id,
                        name: button.dataset.name,
                        price: parseFloat(button.dataset.price),
                        category: button.dataset.category,
                        image: button.dataset.image,
                    };
                    window.suggestCart.addItem(test);
                }
            });

            // --- Sidebar Toggle Listener ---
            sidebarToggle.addEventListener('click', () => {
                sidebar.classList.toggle('collapsed');
                if (sidebar.classList.contains('collapsed')) {
                    toggleIcon.classList.remove('fa-chevron-left');
                    toggleIcon.classList.add('fa-chevron-right');
                    sidebarToggle.style.left = '0px';
                } else {
                    toggleIcon.classList.remove('fa-chevron-right');
                    toggleIcon.classList.add('fa-chevron-left');
                    // Reset based on media query
                    if (window.innerWidth <= 768) {
                        sidebarToggle.style.left = '300px';
                    } else {
                        sidebarToggle.style.left = '380px';
                    }
                }
            });
            // Adjust toggle on resize
            window.addEventListener('resize', () => {
                if (!sidebar.classList.contains('collapsed')) {
                    if (window.innerWidth <= 768) {
                        sidebarToggle.style.left = '300px';
                    } else {
                        sidebarToggle.style.left = '380px';
                    }
                }
            });

            // --- Cart Sidebar Listeners ---
            document.getElementById('cart-icon').addEventListener('click', () => {
                cartSidebar.classList.add('active');
            });
            document.getElementById('cart-icon-header').addEventListener('click', () => {
                cartSidebar.classList.add('active');
            });
            document.getElementById('close-cart').addEventListener('click', () => {
                cartSidebar.classList.remove('active');
            });
            document.getElementById('checkout-btn').addEventListener('click', () => {
                window.suggestCart.checkout();
            });

            // --- Auth Modal Listeners ---
            document.getElementById('auth-form').addEventListener('submit', (e) => {
                e.preventDefault();
                const id = document.getElementById('member-id').value;
                const name = document.getElementById('member-name').value;
                if (verifyUser(id, name)) {
                    isAuthenticated = true;
                    hideAuthModal();
                    // Optional: Thank the user
                    addMessage('bot', `Thank you for verifying, ${name}. How can I continue to help you?`);
                } else {
                    alert("Verification failed. Please check your Member ID and Full Name.");
                }
            });

            document.getElementById('register-link').addEventListener('click', (e) => {
                e.preventDefault();
                showRegisterModal();
            });

            document.getElementById('issues-link').addEventListener('click', (e) => {
                e.preventDefault();
                showIssuesModal();
            });

            document.getElementById('back-to-auth').addEventListener('click', (e) => {
                e.preventDefault();
                hideRegisterModal();
                showAuthModal();
            });

            document.getElementById('back-to-auth-issues').addEventListener('click', (e) => {
                e.preventDefault();
                hideIssuesModal();
                showAuthModal();
            });

            document.getElementById('register-whatsapp').addEventListener('click', () => {
                const name = document.getElementById('register-name').value;
                if (name.trim() === '') {
                    alert('Please enter your name.');
                    return;
                }
                const message = `Hello, I'm ${name} and I would like to register for X-Trim's services.`;
                openWhatsApp(message);
            });

            document.getElementById('issues-whatsapp').addEventListener('click', () => {
                const name = document.getElementById('issues-name').value;
                if (name.trim() === '') {
                    alert('Please enter your name.');
                    return;
                }
                const message = `Hello, I'm ${name} and I'm having an issue with my registration code.`;
                openWhatsApp(message);
            });
            
            // Initial check for sidebar on mobile
             if (window.innerWidth <= 768) {
                sidebar.classList.add('collapsed');
                toggleIcon.classList.remove('fa-chevron-left');
                toggleIcon.classList.add('fa-chevron-right');
                sidebarToggle.style.left = '0px';
            }
        });
        
    </script>
</body>
</html>
